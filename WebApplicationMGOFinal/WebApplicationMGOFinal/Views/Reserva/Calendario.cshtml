
@{
	ViewBag.Title = "Calendario";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Calendario</h2>
<h3>soy peque</h3>
<!--
	div id=calender es la grafico del calendario	
-->
<div id="calender"></div>

<!--llamo a las librerias (sin internet no sirve)-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.print.css" rel="stylesheet" media="print" />

@section Scripts{

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.8.0/fullcalendar.min.js"></script>
	<script src='fullcalendar/lang/es.js'></script>

	<script>
        $(document).ready(function () {
            var events = [];

            $.ajax({
                type: 'GET',
                url: '/Reserva/GetEvents',
                success: function (data) {
                    $.each(data, function (i, v) {
                        events.push({
                            title: v.Subject,
                            description: v.EstadoReserva,
							start: moment(v.FechaInicio),
							end: v.FechaFin != null ? moment(v.FechaFin) : null,
                            color: v.Color,
                            allDay: v.IsFullDay
                        });
                    })

                    GenerateCalender(events);
                },
                error: function (error) {
                    alert('fallido');
                }
            })

            function GenerateCalender(events) {
				$('#calender').fullCalendar('destroy');
				$('#calender').fullCalendar({
					monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
					monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
					dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
					dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'],
					contentHeight: 400,
					defaultDate: new Date(),
					timeFormat: 'h(:mm)a',
					header: {
						left: 'prev,next today',
						center: 'title',
						right: 'month,basicWeek,basicDay,agenda'
					},
					eventLimit: true,
					eventColor: '#BD94E5',
					events: events,
					dayClick: function (date, jsEvent, view) {
						/*var day = date.getDate();       // yields date
						var month = date.getMonth() + 1;    // yields month (add one as '.getMonth()' is zero indexed)
						var year = date.getFullYear();  // yields year
						var hour = date.getHours();     // yields hours 
						var minute = date.getMinutes(); // yields minutes
						var second = date.getSeconds();*/
						//alert('sdncalkdsncdjkachdkjch');
						//var final_string = day + "/" + month + "/" + year + " " + hour + ':' + minute + ':' + second;
						window.location.href = '/Reserva/Create?fecha='+date.toString();
						//window.location.href = '/home';
					}
				});
				
            }

        })
	</script>
}

